---
title: "STATS 205: Homework Assignment 4 (Spring 2019)"
author: ""
date: "4/29/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Solve problems 1 - 6 from the textbook *HWC* [available here](https://onlinelibrary.wiley.com/doi/book/10.1002/9781119196037).

Send your Rmd and PDF files to pjeganat [at] stanford [dot] edu.

**Due on 5/10/2019 at 1.30 p.m.**

Friendly reminder: **Mid-term project proposal due on 5/3/2019 at 1.30 p.m.**

1) *HWC ** Page 133, Problem 1 (rank sum test - large-sample approximation)

2) *HWC ** Page 134, Problem 5 (rank sum test - Wilcoxon)

3) *HWC **  Page 141, Problem 21 (estimate $\delta$ and confidence interval for $\delta$).

4) *HWC ** Page 149, Problem 41. (two sample location when unequal variances)

5) *HWC ** Page 168, Problem 1. (dispersion problem)

6) *HWC ** Page 198, Problem 33 (general distribution test)

7) (Hypothesis testing). This question is taken from **The design of experiment by Sir Ronald A. Fisher (8th edition, 1971). Chapter 3.** [link here](http://www.medicine.mcgill.ca/epidemiology/hanley/tmp/Mean-Quantile/DesignofExperimentsCh-III.pdf).

Darwin raised cross- and self-fertilized corn (Zea mays) plants. He planted equal numbers of each in four different pots, but not same number in each pot. Darwin measured heights of plants. Download and read `Darwin_data.rds` file data from [Canvas @ Stanford](https://canvas.stanford.edu/courses/99104/files/folder/Data?).

```{r}
Darwin.data = data.frame(pair = seq(1, 15), 
  pot = c(rep(1, times=3), rep(2, times = 3), 
    rep(3, times = 5), rep(4, times = 4)), 
  cross.height = c(23.500, 12.000, 21.00, 22.000, 19.125, 
    21.500, 22.125, 20.375, 18.250, 21.625, 
    23.250, 21.000, 22.125, 23.000, 12.000), 
  self.height = c(17.375, 20.375,20.000, 20.000, 
    18.375, 18.625, 18.625, 15.250, 16.500, 
    18.000, 16.250, 18.000, 12.750, 15.500, 18.000))
Darwin.data
saveRDS(Darwin.data, "Darwin_data.rds")
```

(i) Test that there is no difference between heights of crossed and self-fertilized plants using paired sample t-test. What are the assumptions for doing this test? [_Hint: use t.test()_] 

```{r include=FALSE}
t.test(Darwin.data$cross.height, Darwin.data$self.height, alternative = "two.sided", paired = TRUE)
```

(ii) Test that there is no difference between heights of crossed-fertilized and self-fertilized plants using permutation test (test statistic is sum of the difference). What are the assumptions for doing this test?
    a) Let $X$ be height of crossed-fertilized plants and $Y$ be height of self-fertilized plants. Compute the diffrence $Z = X - Y$.
    
```{r include=FALSE}
library(dplyr)
Darwin.data = mutate(Darwin.data, Z = cross.height-self.height)
Darwin.data
```
    b) Test statistic is $T = \sum_{i=1}^{n =15}Z_{i} = \sum_{i=1}^{n =15} |Z_{i}|\delta_{i}$, where $\delta_{i} = 1$ or $\delta_{i} = -1$. Under $\text{H}_{0}$: there is no difference between heights of crossed and self-fertilized plants, $\delta_{i}$ is a fair coin flip $\lbrace -1, 1 \rbrace$. There are $2^{15}=32768$ ways to swap the plus and minus signs, all equaly likely under $\text{H}_{0}$. Use Monte Carlo method to approximate the exact p-value. 
      [_Hint: Choose nperm = 10,000. Create a matrix of $\text{nperm} \times n.$ Sample using sample(c(-1,1), size = n, replace = TRUE) for each row. Multiply each row with absoulte value of $Z$. For each row, compute test statistic value. This is a two-sided test $\text{H}_{A}:$ there is difference between heights of crossed-fertilized and self-fertilized plants. Thus, p-value = $2 \times P\left(T \geq t_{0}\right)$._]

```{r include=FALSE}
abs.diff = abs(Darwin.data$Z)
t0 = sum(Darwin.data$Z)
nperm = 10000
sign.matrix = matrix(replicate(nperm, sample(c(-1,1), size = length(abs.diff), replace = TRUE)), nrow = nperm, byrow = TRUE)
sign.matrix.abs.diff = sweep(sign.matrix, MARGIN=2, abs.diff, `*`)
T.star = apply(sign.matrix.abs.diff, 1, function(x){sum(x)})
P.value = 2*mean(T.star >= t0)
P.value
```

(iii) Test that there is no difference between heights of crossed-fertilized and self-fertilized plants using Wilcoxon signed rank test. What are the assumptions for doing this test?
```{r eval=FALSE, include=FALSE}
wilcox.test(x = Darwin.data$cross.height, y = Darwin.data$self.height, paired = TRUE)
```

(iv) Test that there is no mean difference between heights of crossed-fertilized and self-fertilized plants using nonparamteric bootstrap method and studentized statistic. What are the assumptions for doing this test?
    [_Hint: Compute $Z^{'}_{i} = Z_{i} - \bar{Z}$. Compute studentized statistic $\dfrac{\text{mean}}{\dfrac{\text{standard deviation}}{\sqrt{n}}}$ for each bootstrap sample of $Z^{'}$. Compute p-value._]
    
```{r include=FALSE}
library(boot)
test.stat = function(df){
  sum(df$Z)
}
sum.test.stat = boot(data = Darwin.data$Z, statistic = sum, R = 10000)
```

