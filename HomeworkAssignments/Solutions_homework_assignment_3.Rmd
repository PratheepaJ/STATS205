---
title: "STATS 205: Homework Assignment 3 (Spring 2019)"
author: ""
date: "4/19/2019"
output:
  pdf_document: 
    includes:
      in_header: header.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Solve these problems from the textbook *HWC* [available here](https://onlinelibrary.wiley.com/doi/book/10.1002/9781119196037).

\blc
1) In Lecture 6 (Bootstrap II), we saw an example of LSAT and GPA from 15 students. The data is in an R package `bootstrap`.
```{r}
library(bootstrap); data(law)
t(law)
```

We are interested in inference on the correlation between GPA and LSAT. The point estimate of correlation coefficient is
```{r}
theta.hat = cor(law$LSAT, law$GPA); round(theta.hat, digits = 3)
```

We know that the all possible distinct bootstrap samples can be defined by the weight vector.

```{r}
library(partitions)
n = 15
allCompositions = compositions(n, n);allCompositions[,1:5]
```

Choose randomly $R = 10,000$ columns of allCompositions. (I choose $R = 100$ to save time.)
```{r}
allCompositions.sub = allCompositions[, sample(1:dim(allCompositions)[2], size = 100, replace = FALSE)]
```

(i) Compute bootstrap replicates of correlation (use R codes in Lecture 6).
\bc

The bootstrap replicates are `theta.hat.star`:
```{r}
library(parallel)
nallCompositions.sub = dim(allCompositions.sub)[2]
enumData = mclapply(1:nallCompositions.sub, function(i) {
    ind = allCompositions[,i]
    law.list = lapply(1:n, function(j) matrix(rep(law[j,], ind[j]), ncol = 2, byrow = TRUE))
    newLaw = do.call(rbind, law.list)
    c(cor(unlist(newLaw[,1]), unlist(newLaw[,2])),dmultinom(ind,prob = rep(1,n)))
    }, mc.cores = 4)
```

```{r}
enumData = t(simplify2array(enumData))
colnames(enumData) = c("theta.hat.star","weight")
theta.hat.star = enumData[,1]
```

\blc
(ii) Compute standard error of correlation coefficient estimate using these bootstrap replicates.

\bc 
The standard error of sample correlation coefficient is
```{r}
round(sd(theta.hat.star, na.rm = T), digits = 3)
```

\blc
2) (i) **HWC** Page 21, Problem 9 (discrete data with two categories.) 


Forsman and Lindell (1993) studied swallowing performance of adders (snakes). Captive snakes were fed with dead field voles (rodents) of differing body masses and the number of successful swallowing attempts was recorded. Out of 67 runs resulting in swallowing attempts, 58 where successful and 9 failed. (A failure was easy to detect because the fur of a partly swallowed and regurgitated vole is slick and sticks to the anterior part of the body.) Test the hypothesis that $p = .6$ against the alternative $p > .6$.

\bc

We need to test $\text{H}_{0}: p = .6$ versus $\text{H}_{0}: p > .6$.

The test statistic is $Z = \dfrac{B-n p_{0}}{\left(n p_{0}(1-p_{0})\right)^{1/2}} \sim \text{N}\left(0, 1\right)$, where $p_{0} = .6$.

Compute the observed value of test statistic
```{r}
Z.obs = (58-67*.6)/(sqrt(67*.6*.4)); round(Z.obs, digits = 3)
p.value = pnorm(Z.obs, lower.tail = FALSE); round(p.value, digits = 3)
##OR
p.value = 1-pnorm(Z.obs); round(p.value, digits = 3)
```

We reject the null hypothesis at 5\% significance level.

\blc
(ii) In addition, find the power of the test if $p =.7$ and $p = .8$. 

\bc

Power for the test when p = .7.


We have $Z^{*}=\dfrac{B - 67 \left(p\right)}{\left(67 \left(p\right)\left(1-p\right)\right)^{1/2}} \sim \text{N}\left(0, 1\right)$. 

\rc
Now $Z = \dfrac{B-n p_{0}}{\left(n p_{0}(1-p_{0})\right)^{1/2}} \nsim \text{N}\left(0, 1\right)$ \bc

\begin{equation}
    \tiny
    \notag
    \begin{split}
    \text{Power}& =  P\left(Z \geq 1.645| p = .7\right)\\
    &= P_{p = .7}\left(\dfrac{B - n\left(p_{0}\right)}{\left(n \left(p_{0}\right)\left(1-p_{0}\right)\right)^{1/2}} \geq 1.645\right)\\
    &=  P_{p = .7}\left(B \geq 1.645 \left(n \left(p_{0}\right)\left(1-p_{0}\right)\right)^{1/2} + n \left(p_{0}\right)\right)\\
    &=  P_{p = .7}\left(\dfrac{B - n \left(p\right)}{\left(n \left(p\right)\left(1-p\right)\right)^{1/2}} \geq \dfrac{1.645 \left(n \left(p_{0}\right)\left(1-p_{0}\right)\right)^{1/2} + n \left(p_{0}\right)- n \left(p\right)}{\left(n \left(p\right)\left(1-p\right)\right)^{1/2}}\right)\\
    &= P\left(Z^{*} \geq z_{0}^{*} \right).
    \end{split}
    \end{equation}
    

```{r}
z.0.star = function(n, p0, p, critical.value){
  (critical.value*sqrt(n*p0*(1-p0)) + n*p0 - n*p)/(sqrt(n*p*(1-p)))
}
```

Calculate $z_{0}^{*}$ when $p=.7$:
```{r}
z.0.star.v = z.0.star(n = 67, p0 = .6, p = .7, critical.value = 1.645);z.0.star.v
```

Power of the test when p = .7
```{r}
1-pnorm(z.0.star.v)
```

Calculate $z_{0}^{*}$ when $p=.7$:
```{r}
z.0.star.v = z.0.star(n = 67, p0 = .6, p = .8, critical.value = 1.645);z.0.star.v
```

Power of the test when p = .8
```{r}
1-pnorm(z.0.star.v)
```

The power of the test increases with increasing value of $p$ for fixed sample size.

\blc

3) **HWC** Page 24, Problem 11 (estimate for $p$ and standard error for $\hat{p}$). 

Calculate $\hat{p}$ for the parolee data of Problem 1 (above problem) and obtain an estimate of the standard deviation of $\hat{p}$.

\bc
Calculate $\hat{p}$
```{r}
p.hat = 58/67; round(p.hat, digits=3)
```

Estimate for the standard deviation of $\hat{p}$
```{r}
round(sqrt(p.hat*(1-p.hat)/67), digits = 3)
```

\blc

4) **HWC** Page 31, Problem 15 (confidence interval for $p$). 

For the parolee data of Problem 1, obtain the Wilson, Laplace–Wald, Agresti–Coull, and Clopper–Pearson confidence intervals for $p$, each with an approximate confidence coefficient of .96. Compare the four intervals.

\bc
```{r}
library(binom)
binom.confint(x=25, n=50, conf.level=.96, methods = "all")
```

All Wilson, Laplace–Wald, Agresti–Coull, and Clopper–Pearson lower and upper limits of confidence intervals for $p$ with .96 are close.

\blc

5) **HWC* Page 33, Problem 23 (Chi-squared test for more than two categories).

Devore (1991) gives an example from the paper “Linkage Studies of the Tomato” (Tran. Royal Canadian Inst., 1931, pp 1-19) on phenotypes from a dihybrid cross of tall, cut-leaf tomatoes with dwarf, potato-leaf tomatoes. Dihybrid crosses arise as follows. If two different characteristics of an organism are each controlled by a single gene, and a pure strain having genotype AABB is crossed with a pure strain having genotype aabb (A,B are dominant alleles; a,b are recessive), the resulting genotype is AaBb. A dihybrid cross occurs when the first- generation organisms are crossed among themselves. The data for a dihybrid cross of tall, cut-leaf tomatoes with dwarf, potato-leaf tomatoes, based on a sample of n=1611, are as follows: Tall, cut-leaf (926); tall, potato-leaf (288); dwarf, cut-leaf (293); dwarf, potato-leaf (104) (tall is dominant for size, cut-leaf is dominant for leaf type). Mendelian inheritance theory predicts that there are four categories of probabilities occurring, 9/16, 3/16, 3/16, 1/16. Test if the data support Mendelian theory.

\bc


\begin{tabular}{lll}
Genotype & Observed & expected frequency\\
Tall cut-leaf & 926 & 9/16\\
Tall potato-leaf & 288 & 3/16\\
Dwarf cut-leaf & 293 &3/16\\
Dwarf potato-leaf &104 &1/16
\end{tabular}


$\text{H}_{0}$: Dihybrid crosses comprise of four genotype in the proportions mentioned by Mendelian theory.

There are four different categories for $X$ (genotype) variable. Fixed $n = 1611$. So the degrees of freedom is 3.
```{r}
observed = c(926, 288, 293, 104)
total = sum(observed)
expected = c((9/16)*total, (3/16)*total, (3/16)*total, (1/16)*total)
sum((observed - expected)^2/expected)
```

Here we have degress of freedom of number of categories - 1 = 3. The p-value for the test is

```{r}
pchisq(1.469, df = 3, lower.tail = FALSE)
```

We fail to reject $\text{H}_{0}$. We do not have enough evidence to reject the Mendelian theory.

\blc 
6) **HWC* Page 513, Problem 13 (Fisher's exact test on difference on probabilities. Use `fisher.test()` function in R).

Consider Problem 12 and the reactivity data of Table 10.11. Mendis, Ihalamulla, and David (1988) claimed a “significantly higher incidence of reactivity” in the multiple-attack patients. (In our notation of Problem 12, their conclusion corresponds to the alternative $p_{1} < p_{2}$, or equivalently, $\left(1 - p_{1} > 1- p_{2}\right.)$ Mendis, Ihalamulla, and David (1988) based their conclusion on the $\chi^{2}$ statistic defined by (10.18). Apply the approximate test based on $\chi^{2}$. Compare their conclusion with your conclusion obtained in Problem 12, recalling that the P-value obtained in Problem 12 is one-sided and the P-value based on $\chi^{2}$ is two-sided.

\bc

Let $p_{1}$ be the probability that a multiple-attack patient will have incidence of reactivity and $p_{2}$ be the probability that a primary-attack patient will have incidence of reactivity.

Testing $\text{H}_{0}:p_{1} = p_{2}$ versus $\text{H}_{A}:p_{1} < p_{2}$
```{r}
Table10.11 = data.frame(Low = c(0, 2), High = c(5, 1))

rownames(Table10.11) = c("Multiple Attack", "Primary Attack")

Table10.11
```

Use Fisher's exact test:
```{r}
fisher.test(Table10.11, alternative  = "less")
```

Use $\chi^{2}$ test:

```{r}
Table10.11.matrix = as.matrix(Table10.11)
chisq.test(Table10.11.matrix, correct = T)
```

P-value for one-sided test is 
```{r}
chisq.test(Table10.11.matrix)$p.value/2
```

Using Fisher's exact test and the $\chi^{2}$ test there is not enough evidence to conclude that the multiple-attack patients have lower incidence of reactivity than primary attack patients.

Fisher's exact test is based on the hypergeometry distribution and produces exact p-value for the test. The $\chi^{2}$ test can only approximates the p-value. 

\blc

7) **HWC* Page 509, Problem 3 (approximate confidence interval for difference of proportions)

Vianna, Greenwald, and Davies (1971) considered a series of 101 Hodgkin’s disease patients, with the purpose of testing the theory that the tonsils protect the body against invasion of the lymph nodes by a Hodgkin’s disease virus. (The existence of such a virus has not been established.) Among the 101 Hodgkin’s cases, they found 67 had had a tonsillectomy, whereas in a control group of 107 patients with other complaints, 43 had had a tonsillectomy. Compute 99% confidence limits for the difference in true rates.

\bc
Let $p_{1} =$ proportion of Hodgkin’s cases had tonsillectomy and $p_{2} =$ proportion of control group had tonsillectomy.

We need to find 99\% confidence interval for $p_{1} - p_{2}$.

Let us use the large-sample approximation to construct the confidence interval.

```{r}
prop.test(x = c(67,43), n = c(101,107), conf.level = 0.99, correct = FALSE)
round(prop.test(x = c(67,43), n = c(101,107), conf.level = 0.99, correct = FALSE)$conf.int, digits = 3)
```

The 99\% confidence interval for the difference of proportions of having tonsillectomy in Hodgkin’s cases to control group is $\left( .090, .433\right)$.

\blc 
8) **HWC* Page 510, Problem 6 (Matched Pairs problem. Use `mcnemar.test()` function in R).

Cruess (1989) points out that the error of applying the ordinary chi-squared statistic to paired data occurs frequently in the medical literature. Cruess cites in particular the study of Shen et al. (1988). They compared the results of two tests, ABC-ELISA and standard ELISA, on 101 hydatidosis patients. (Hydatidosis, or hydatid disease, is infestation with echinococcus, a genus of tapeworms.) Shen et al. used the ordinary unpaired chi-squared test and reported a $\text{P-value} < .0005$. This was inappropriate because each case was tested using both laboratory procedures and thus the data were paired. Instead of the ordinary unpaired chi-squared test, McNemar’s test should have been performed. Table 10.9 gives the information on the 101 pairs.

Perform McNemar’s test. What is the P-value? What do you conclude concerning the hypothesis of equal proportions positive for both ELISA tests?

\bc

Let $p_{1}$ denote proportion positive for ABC-ELISA test and $p_{2}$ denote proportion positive for standard ELISA test.

$\text{H}_{0}: p_{1} = p_{2}$ versus $\text{H}_{A}: p_{1} \neq p_{2}$.

```{r}
Table10.9 = matrix(c(82, 13, 6, 0), byrow=T, nrow=2) 
Table10.9
```


```{r}
mcnemar.test(Table10.9, correct = FALSE)
```

We do not have enough evidence to conclude that the proportion positive for ABC-ELISA and ELISA tests are different.

\blc

9) **HWC* Page 510, Problem 9 ($2 \times 2$ Chi-squared test for independence).

Astin et al. (1995) studied posttraumatic stress disorder (PTSD) and childhood abuse in battered women. PTSD prevalence rates were compared among 50 battered women and 37 maritally distressed women who had not experienced battering. The results are given in Table 10.10.
Is there a significant difference in the PTSD rates for battered women versus maritally distressed women (who had not experienced battering)?

\bc

```{r}
Table10.10 = data.frame(battered.women = c(29, 21), distressed.women = c(7, 30))
rownames(Table10.10) = c("PTSD", "No.PTSD")
Table10.10
```

Let $p_{1}$ be proportion of PTSD in battered women and $p_{2}$ be proportion of PTSD in distressed women. 

This is a study on PTSD (PTSD/ no PTSD) and battered women (battered/distressed).
```{r}
Table10.10.matrix = matrix(c(29,7,21,30), byrow = T, nrow = 2)
chisq.test(Table10.10.matrix)
```

We can conclude at 5\% significance level that there a significant relation between the PTSD and distressed women.

